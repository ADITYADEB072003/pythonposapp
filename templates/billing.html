{% extends "base.html" %}
{% block content %}
<h2 class="mb-4 fw-bold text-primary"><i class="bi bi-cart3"></i> Billing - Select Items</h2>

<form method="GET" class="mb-4">
  <input type="text" name="search" placeholder="Search items..." class="form-control rounded-pill shadow-sm" value="{{ search }}">
</form>

<div class="row g-4">
  <!-- Items Column -->
  <div class="col-12 col-lg-8 order-1 order-lg-1 overflow-auto" style="max-height: 75vh;">
    <div class="row g-3">
      {% for item in items %}
      <div class="col-12 col-sm-6 col-md-4">
        <div class="card h-100 shadow rounded-4 border-0">
          <div class="card-body d-flex flex-column justify-content-center text-center">
            <div class="display-1 mb-3" aria-label="Shopping cart emoji">ðŸ›’</div>
            <h5 class="card-title fw-semibold text-truncate">{{ item.name }}</h5>
            <p class="card-text fs-5 text-success mb-1">â‚¹{{ item.price }}</p>
            <p class="mb-3"><small class="text-muted">Stock: <span class="{{ 'text-danger' if item.quantity == 0 else 'text-info' }}">{{ item.quantity }}</span></small></p>
            <form method="POST" action="{{ url_for('billing') }}" class="d-flex justify-content-center align-items-center gap-2 flex-wrap">
              <input type="hidden" name="item_id" value="{{ item._id }}">
              <input type="number" name="quantity" min="1" max="{{ item.quantity }}" value="1" class="form-control form-control-sm rounded-pill shadow-sm" style="width: 80px;" {% if item.quantity == 0 %}disabled{% endif %} aria-label="Quantity input for {{ item.name }}">
              <button class="btn btn-primary btn-sm rounded-pill px-4 fw-semibold shadow-sm" {% if item.quantity == 0 %}disabled{% endif %} aria-label="Add {{ item.name }} to cart">
                <i class="bi bi-cart-plus-fill me-1"></i> Add
              </button>
            </form>
            {% if item.quantity == 0 %}
            <span class="badge bg-danger mt-3">Out of Stock</span>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Cart Column -->
  <div class="col-12 col-lg-4 order-2 order-lg-2">
    <div class="card shadow rounded-4 border-0 bg-light sticky-top" style="top: 1rem;">
      <div class="card-header bg-primary text-white fw-bold d-flex align-items-center gap-2 rounded-top-4">
        <i class="bi bi-basket-fill"></i> Cart
      </div>
      <div class="card-body p-3 overflow-auto" style="max-height: 70vh;">
        {% if cart %}
        <!-- Desktop / Tablet Table -->
        <div class="d-none d-md-block">
          <table class="table table-hover align-middle mb-0 rounded-3">
            <thead class="table-primary">
              <tr>
                <th>Item</th>
                <th style="width:75px;">Qty</th>
                <th style="width:100px;">Price</th>
                <th style="width:110px;">Subtotal</th>
                <th style="width:100px;">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for ci in cart %}
              <tr>
                <td class="fw-semibold text-truncate" style="max-width: 150px;">{{ ci.name }}</td>
                <td>{{ ci.cart_qty }}</td>
                <td>â‚¹{{ ci.price }}</td>
                <td>â‚¹{{ ci.subtotal }}</td>
                <td>
                  <form method="POST" action="{{ url_for('delete_cart_item', item_id=ci._id) }}" style="display:inline;">
                    <button class="btn btn-danger btn-sm rounded-pill shadow-sm" onclick="return confirm('Remove this item?')" aria-label="Delete {{ ci.name }} from cart">
                      <i class="bi bi-trash-fill"></i>
                    </button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Mobile Cards -->
        <div class="d-block d-md-none">
          {% for ci in cart %}
          <div class="card mb-3 shadow rounded-4">
            <div class="card-body d-flex flex-column">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="card-title fw-semibold text-truncate mb-0">{{ ci.name }}</h5>
                <form method="POST" action="{{ url_for('delete_cart_item', item_id=ci._id) }}">
                  <button class="btn btn-outline-danger btn-sm rounded-circle p-1 shadow" style="width:36px; height:36px;" onclick="return confirm('Remove this item?')" aria-label="Delete {{ ci.name }} from cart">
                    <i class="bi bi-trash-fill"></i>
                  </button>
                </form>
              </div>
              <div class="d-flex justify-content-between mb-1">
                <span>Quantity:</span>
                <span>{{ ci.cart_qty }}</span>
              </div>
              <div class="d-flex justify-content-between mb-1">
                <span>Price:</span>
                <span class="text-success">â‚¹{{ ci.price }}</span>
              </div>
              <div class="d-flex justify-content-between fw-semibold">
                <span>Subtotal:</span>
                <span>â‚¹{{ ci.subtotal }}</span>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info rounded-4 shadow-sm">No items in cart.</div>
        {% endif %}
      </div>

      {% if cart %}
      <div class="card-footer bg-white d-flex justify-content-between align-items-center rounded-bottom-4 shadow-sm py-3">
        <div class="fw-bold fs-5 text-success">Total: â‚¹{{ total }}</div>
        <form method="POST" action="{{ url_for('checkout') }}" class="mb-0">
          <button class="btn btn-success btn-lg rounded-pill shadow-sm px-4" aria-label="Proceed to checkout">
            <i class="bi bi-credit-card-fill me-2"></i> Checkout
          </button>
        </form>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
// Existing JS for Edit, Delete, Search remains unchanged
</script>

<style>
.card {
  border-radius: 1.1rem !important;
}
.btn-primary, .btn-success {
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
}
.btn-primary:hover, .btn-primary:focus {
  background-color: #0b5ed7;
  box-shadow: 0 0 10px rgba(11, 94, 215, 0.5);
}
.btn-success:hover, .btn-success:focus {
  background-color: #198754;
  box-shadow: 0 0 10px rgba(25, 135, 84, 0.5);
}
.form-control:focus {
  border-color: #44caff;
  box-shadow: 0 0 0 0.2rem rgba(68, 202, 255, 0.25);
}
.rounded-4 {
  border-radius: 1.25rem !important;
}
.card-header {
  border-top-left-radius: 1.25rem;
  border-top-right-radius: 1.25rem;
}
.card-footer {
  border-bottom-left-radius: 1.25rem;
  border-bottom-right-radius: 1.25rem;
}
.overflow-auto {
  scrollbar-width: thin;
  scrollbar-color: rgba(0,0,0,.1) transparent;
}
.overflow-auto::-webkit-scrollbar {
  height: 6px;
  width: 6px;
}
.overflow-auto::-webkit-scrollbar-thumb {
  background-color: rgba(0,0,0,.1);
  border-radius: 3px;
}
</style>
{% endblock %}
